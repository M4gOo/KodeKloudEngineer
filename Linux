
===================== In doubt

If the apropos command does not work because your manual pages are not indexed
Getting this message "nothing appropriate."
#
mandb
#
apropos "nfs mount"
# 
<command> help
check manuals programs packages installed on the system /usr/share/doc


check package
dnf(yum) provides */mkfs.vfat

==========================================        Manage Users and Groups     ======================================================


Create, delete, and modify local user accounts ===========================================================================


sudo useradd <username>
it will automatically create user and group with the username, also a shell and a home dir
sudo useradd --shell /bin/othershell --home-dir /home/otherdirectory/ john


sudo adduser kareem -s /sbin/nologin    -> non-interactive shell
a non-interactive shell is a type of shell that doesn't interact with the user. We can run it through a script or similar. Also, it can be run through some automated process.


useradd -M <name>      ----> wihtout home dir

useradd --defaults   OR  useradd -D

another defaults configurations can be seen in
cat /etc/login.defs

setup a password
sudo passwd <username>

delete acc and group. Home dir it will remain
sudo userdel <username>

delete acc and the home dir
sudo userdel --remove john   OR      sudo userdel -r john

delete a groupd
sudo groupdel <groupname>

to choose id for the user
sudo useradd --uid 1100 <username>

to check the id numbers and home dir
ls -ln /home

id
check group, userid and so on

create system account
sudo useradd --system <systemname>
those numbers are smaller than 1000
usually daemon use system accs

with want to change conf after create user
sudo usermod --home /home/otherdir --move-home john   OR    sudo usermod -d /home/otherdir -n john
sudo usermod --login <new_username> <old_username>    OR    sudo usermod -l <new_username> <old_username>
sudo usermod --shell /home/otherdir <username>        OR    sudo usermod -s /home/otherdir <username>

disable the acc. Lock the user account
sudo usermod --lock <username>    OR sudo usermod -L <username>       
username cannot login even using the password, but can login using ssh if was set up before lock
to avoid that set up a expire date
sudo usermod --expiredate 2020-12-20 <username>     if you want to set up now, just choose a date in the past
to remove expiry date 
sudo usermod --expiredate "" <username> 

password for all new users in domain.com should expire after 20 days
vi /etc/login.defs
PASS_MAX_DAYS 20

check the user acc regarding expiration
#
sudo chage -l <username>

to easy calculate
date -d +15days

to set up an expiration date for password. This command set expired password and the user are force to immediately change it the next time logs in
sudo chage --lastday 0 <username>

to cancel expiration date for password
sudo chage --lastday -1 <username>

to set up a date for user change the password
sudo chage --maxdays 30 <username>

set up for password never expiry
sudo chage --maxdays -1 <username>

to see the list for password expires
sudo chage --list <username>

User gets a warning at least 2 days before the password expires
sudo chage -W 2 <username>


Create, delete, and modify local groups and group memberships ===========================================================================

sudo groupadd developers

add user to a group
sudo gpasswd --add <usrname> <developers>

to see which group the user belongs to
groups <username>

delete a user to a group
sudo gpasswd --delete <username> <developers>

change the primary group of the user
sudo usermod -g <developers> <username>     OR   sudo usermod --gid <developers> <username>
the capital G flag is to change the secondary group

group named cricket and set its GID to 9875
sudo groupadd -g 9875 cricket 

to rename the group
sudo groupmod --new-name <nem_name> <old_name>

to delete a grooup
sudo groupdel <groupname>


Manage access to the root account  ==========================================================================================================

login as a root, when the user has sudo priv
sudo --login   OR  sudo -i

when the user doesnt have sudo priv, but knows root password
su -  

some system they have root locked, means we cannot login with root acc only with the password
we can login using sudo -i, but not su -
also can login using ssh private key

to unlock use
sudo passwd root   OR   sudo passwd --unlock root

to lock root acc, avoid using password
sudo passwd --lock root

change the root password
sudo passwd

disable root login - ssh
cat /etc/ssh/sshd_config  | grep PermitRoot
PermitRootLogin no
# the setting of "PermitRootLogin without-password".
sudo systemctl restart sshd


CHMOD   =================================================

----------------------------- setuid,setgid,stickybit
[S ; s (with x)] SETUID -  makes an executable run with the privileges of the owner of the file.  
[S ; s (with x)]SETGID -  makes an executable run with the privileges of the group of the file.
[T ; t (with x)] STICKY BIT - This permission does not affect individual files. At the directory level, it restricts file deletion. 
                              Only the owner (and root) of a file can remove the file within that directory.
4 - r
2 - w
1 - x

u - user (owner)
g - group
o - other 
a - all (u, g, and o)
 
sudo chmod g+s     ensure that for all future files within /directory the group owner will be the same as set in /directory
sudo chmod g+rw
sudo chmod u-w
chmod go+rw 
 
 setuid Command will be run with owner rights instead of the rights of the executer
 chmod u+s /root
 set gid ensure that for all future files within /directory the group owner will be the same as set in /directory
 sudo chmod g+s


ACL =======================================


 ACLs (Access Control Lists) defines specific permissions for two or more users/groups
 
 sudo setfacl --modify user:<username>:rw file.txt
 sudo setfacl -m group:Mac:--- /var/fstab             group Mac wont have any permissions
 
 when you use the command ls -l will see a + mark at the end
 to check tha acl in the file
 getfacl file.txt                                             the output shows the mask, which means the maximum permission we can get in that file
 
 sudo setfacl --modify mask:r file.txt                                  to set/change a mask
 sudo setfacl --remove user/group:<username/groupname> file.txt         to remove acl group/user
 sudo setfacl --recursive -m user:<username>:rw dir/                    to set ucl dir and subdir/files as well
 sudo setfacl --recursive --remove user:<username> dir/                 to remove ucl dir and subdir/files as well


set permissions for user which all new creating files will be -r-------- and dir dr-x------ as default permission
vi .bash_profile
#after fi type
umask 277


SED =====================================================

  
  sed 's/old_string/new_string/g' file.txt
  s -> substitute
  g -> global replace
  
  sed -i 's/old_string/new_string/g' file.txt
  -i -> will edit the file, it will swap the strings
  
  sed -i 's/disabled/enabled/gi'
  gi - ignore case sensitive. For example, any string like disabled, DISABLED, Disabled
  
  
  Change all values enabled to disabled only from line number 500 to 2000.
  
  sed -i '500,2000s/enabled/disabled/g' file
  
  Replace all occurrence of string #%$2jh//238720//31223 with $2//23872031223 i
  
  sed -i 's~#%$2jh//238720//31223~$2//23872031223~g' file

  delete a specific word
  sudo sed -i '/<word>/d' test.txt > test_deleted_word.txt 
  sudo sh -c "sed '/code/d' file.txt > file_delete.txt"

  Replace all occurrence of word or to fo
  sed 's/\bor\b/for/g' /home/FILE.txt > /home/FILE_REPLACE.txt


FIND ================================================


#
find /opt/assets/ -type f -exec grep -Iq . {} \; -print        find file that contains text, when the others are empty
#
find /opt/assets -type f -perm 2664 -exec cp -p {} /home/bob/specialfiles/ \;

 find /home/usersdata/ -type f -user bob -exec cp --parents {} /media \;
--parents => preserve the directories path 

find /var/www/html/beta -type f -name '*.php' -exec cp --parents {} /beta \;          --> Copy all those files along with their parent directory structure to location /beta
[steve@stapp02 beta]$ pwd
/beta/var/www/html/beta

SUID - 4
SGID - 2
Sticky bit - 1
-exec <command> {} \;
      find will execute <command> and will substitute {} with the filename(s) found. 
      with ; a single <command> for each file is executed 
      escaped here as \; to prevent the shell from interpreting it

{} \; : executing the commands for each found result
{} + : executing the command once with all results argument like this -> ls file1.txt file2.txt file3.txt  


find /path -name file.txt
find /path -iname file.txt              -case sensitive
find -mmin        modified minute (modified means creation or editing a file) Modified means when the contens have been modified
find -mmin 5      5 min ago (if now is 11:00 it will find files in 10:55)
find -mmin -5     5 min ago (if now is 11:00 it will find files BETWEEN 10:55 until 11:00)
find -mmin +5     list files before 5 min ago (if now is 11:00 it will find files from 10:55 to the infinite 10:45, 10:30, 9:30, etc)
  
find -mtime 0     search for files per days or past-24hours periods
0 past 24 hours
1 24h to 48h
  
created
find -cmin -5   created last 5 minutes
  
find -size
c bytes
k kilobytes
M megabytes
G gigabytes
  
find -size 512k       = 512
find -size +512k      > 512
find -size -512k      < 512
                            
sudo find /usr -type f -size +5M -size -10M           Find all files between 5mb and 10mb in the /usr directory
             
find -perm 664       exactly perm
find -perm -664       find bearly perm  
find -perm -u=rw,g=rw,o=r       find bearly perm                          
find -perm /664       find files with any of these perm                          
                             
find -name "f*" -size 512k          AND operator                     
find -name "f*" -o -size 512k       OR operator  
find -not -name "f*"                NOT operator
 
Find files/directories under /var/log/ directory that the group can write to, but others cannot read or write to
sudo find /var/log/ -perm -g=w ! -perm /o=rw                          
! expr : True if ‘expr’ is false.
not to be r or w. That means, if any of these two permissions, r or w match for others, the result has to be excluded


LAST ==================================================

to see who is logged in the system
last     
lastlog  (ssh will see an IP addr)


============================================================================== Locate and analyze system log files 


make journalctl persistent
sudo mkdir /var/log/journal
Edit the file /etc/systemd/journald.conf
[Journal]
Storage=persistent
Next, restart the systemd-journald
systemctl restart systemd-journald
journalctl --flush

log daemon rsyslog is the popular in Linux that stores all logs in /var/log

ls /var/log/

grep -r 'ssh' /var/log/

system logs
/var/log/messages
/var/log/

tail -F /var/log/secure   (you can watch the log waiting for inputs; liveview)

journalctl              ( > you can use to navigate)
journalctl /bin/sudo
journalctl -u sshd.service
journalctl -e                 (go to end to the journalctl)
journalctl -F                 (liveview)
journalctl -p err             (use journalctl -p to list those using 2 TAB -> (err, alert, crit, debug, emerge, info, notice, warning, ...))
journalctl -S 02:00                     -S for specify time
journalctl -S 01:00 -U 02:00            logs started in 01:00 to 02:00
journalctl -S  '2021-11-16 12:04:55'
sudo journalctl -p info -g '^c'               Analyse the info priority logs through journalctl that begin with letter c
journalctl logs are reset after reboot/power off, to save create /var/log/journal/


SCP =====================================

 sudo scp /tmp/file.txt.gpg  bob@server2:/tmp/


SSH ============================================

-----------------------Set up a password-less authentication:

ssh-keygen
#check in ~/.ssh
id_rsa  id_rsa.pub

ssh-copy-id <username_for_server1>@server1
#check in ~/.ssh
authorized_keys

bob@server1 ~/.ssh$ cat id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCgQbr7yOVeMgIlS3yWYeO8RhIJRnWgzqUKHvXw92UfXmXkF6ofjFL5ruGjfKWmfstRAziA5E5Zhmf9mYsdjoEgWOmenmA2SWVYdu86nqwnR4aNINWaPIFsL
W7wocVty2bKRj1LfrlTjbOusUPzFFlBJP70nq79p0Ia4EGMXeIthCHk0hg91exBisbLnP96L+hv8hHCGJgyO9fvdQ/PhYHvjXskb5TE8htvOsSQ9UhV3WEVF1pOmBZZL8z3AU4i2jBzjiiGDtZqcjFzNxP+J
TAv2CMoFkhITIdWWYySXYL9Q30gnKnoIRJVDtHbGIFmEc5nidXPi+UKn6o2R5/FOdYcEudjt5pFRceeLppOGCgpYC0nkMQKXbryumad4Wj4KqYfDZfopQDMDa4RGWEnqCwGG9CJHQLyhqvuvld3HhjUaW5C/yE
cukv/ZsQZS+cfBy9Q1I3Od+bkw9VhRcNtLCf1YDiFk7hFjNllMvocA/3KFNmJcNG/BM18bdWK38hIEt8= bob@server1.domain.com

[alice@server2 .ssh]$ cat authorized_keys 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCgQbr7yOVeMgIlS3yWYeO8RhIJRnWgzqUKHvXw92UfXmXkF6ofjFL5ruGjfKWmfstRAziA5E5Zhmf9mYsdjoEgWOmenmA2SWVYdu86nqwnR4aNINWaPIFsL
W7wocVty2bKRj1LfrlTjbOusUPzFFlBJP70nq79p0Ia4EGMXeIthCHk0hg91exBisbLnP96L+hv8hHCGJgyO9fvdQ/PhYHvjXskb5TE8htvOsSQ9UhV3WEVF1pOmBZZL8z3AU4i2jBzjiiGDtZqcjFzNxP+J
TAv2CMoFkhITIdWWYySXYL9Q30gnKnoIRJVDtHbGIFmEc5nidXPi+UKn6o2R5/FOdYcEudjt5pFRceeLppOGCgpYC0nkMQKXbryumad4Wj4KqYfDZfopQDMDa4RGWEnqCwGG9CJHQLyhqvuvld3HhjUaW5C/yE
cukv/ZsQZS+cfBy9Q1I3Od+bkw9VhRcNtLCf1YDiFk7hFjNllMvocA/3KFNmJcNG/BM18bdWK38hIEt8= bob@server1.domain.com

-------------------------------------



CRONJOB - CRONTAB =====================================

sudo dnf -y install cronie

systemctl status crond

verify cronjob
do something with 2min to check 

cat /etc/crontab 
  can use  ',' this it will run multiple times like 15min and 45minutes -> 15,45
  can use '-', set hours to 2-4 2am,3am,4am
  can use '/', to specifies steps, every 4hours it will run. */3 * * * * ->execute every 3min
  Minute(0-59) Hour(0-23) Day_of_month(1-31) Month(1-12) Day_of_week(0-6) [Sunday=0 or 7] or sun,mon,tue,wed,thu,fri,sat
  
check the service is running in the machine
service cron status
service cron start

crontab -e 
  edit the table of your current user
  
crontab -l   - to see user logged in cronjobs

to edit as sudo just add sudo at the front
sudo crontab -l       list
sudo crontab -e       edit
30 21 * * * /usr/bin/touch test_passed

to add with different user
sudo crontab -e -u <username>

to remove cronjob
crontab -r
sudo crontab -r -u <username>

to run a sheel script in a cronjob dont add extension
makes executable
sudo chmod +rx /etc/cron.hourly/shellscript
if want run hourly (/etc/cron.hourly) just move to this dir, using sudo 

check the logs
sudo cat /var/log/cron

to send an email to user change the MAILTO=root

to deny user to do cronjob
/etc/cron.deny      #ype the name user in the file and save
to verify login with the user and try to use the command crontab -e



Run Levels ===================================================


system's current default boot target can be basic.target, graphical.target , etc

to check our default boot
systemcl get-default
graphical.target

#
systemctl get-default
systemctl set-default
ls -l /usr/lib/systemd/system/

sudo systemctl set-default multi-user.target  
sudo systemctl isolate graphical.target  (temporary gives a graphical prompt, after reboot back to the default you set to boot)
sudo systemctl isolate emergency.target   (for troubleshooting, read permissions, few system are loaded). You must have root password
sudo systemctl isolate rescue.target      (root permission, there will be more programs than emergency). You must have root password

systemd targets
Targets in systemd act as synchronization points during the start of your system.
The purpose of target units is to group together various systemd units through a chain of dependencies.
The graphical.target unit for starting a graphical session, starts system services such as the GNOME Display Manager 
(gdm.service) or Accounts Service (accounts-daemon.service), 
and also activates the multi-user.target unit.

basic
unit target covering basic boot-up

rescue
unit target that pulls in the base system and spawns a rescue shell

multi-user
unit target for setting up a multi-user system

graphical
unit target for setting up a graphical login screen

emergency
unit target that starts an emergency shell on the main console. provides the most minimal environment possible and allows you to repair your system even 
in situations when the system is unable to enter rescue mode. In emergency mode, the system mounts the root file system only for reading, 
does not attempt to mount any other local file systems, does not activate network interfaces, and only starts a few essential services.

sysinit
unit target that pulls in the services required for system initialization



timedatectl ===================================================


timedatectl set-timezone America/California

Configure time service clients  - NTP (Network Time Protocol)------------------

sudo yum install chrony
sudo vi /etc/chrony.conf    server <ip> iburst    and comment  #pool 2.centos.pool.ntp.org iburst
systemctl restart chronyd
chronyc sources -v  
sudo systemctl set-ntp true

keep the clock accurate
chrony daemon 

to see it is enable
systemctl status chronyd.service

run this command to check the system clock is synchronized
timedatectl

timedatectl list-timezones 
timedatectl list-timezones | grep America 

if is not enable by default first check if the time zone is set correctly
sudo timedatectl set-timezone America/New_York          to see all available zones timedatectl list-timezones
sudo dnf install chrony
sudo sysstemctl start chronyd.service
sudo sysstemctl enable chronyd.service
then check the ntp is enable and system clock is synch using the command
timedatectl
in case is not enable
sudo systemctl set-ntp true
 

Using timedatectl configure RTC (real-time clock) to maintain the RTC in local time.
RTC is a battery-powered computer clock that keeps track of the time even when the system is turned off.
sudo timedatectl set-local-rtc 1

NTP ---------------------------------------------  Linux NTP Setup
 chrony is an implementation of the Network Time Protocol (NTP)   

 sudo yum install ntp 
 
 chrony consists of chronyd, a daemon that runs in user space
 chronyc a command line program which can be used to monitor the performance of chronyd and to change various operating parameters when it is running.
 
 system synchronous as 172.24.40.10
  
 dnf install chrony
 
 Changes made using chronyc are not permanent, they will be lost after a chronyd restart. 
 For permanent changes, modify /etc/chrony.conf
 
 server ntp.lab.int_OR_IP iburst
 
 After applying the configuration changes, restart the chronyd service
 
 chronyc sources -v    displays information about the current time sources
 
 timedatectl
 timedatectl set-ntp true
 
 
 configure server need to add the ip
 server ntp.lab.int iburst
allow 192.168.0.0/24

and add entries in the firewall
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload


firewalld========================================================

block accessing your system from 184.25.0.0/24

 firewall-cmd --permanent --add-source=184.25.0.0/24 --zone=block
 firewall-cmd --reload
 firewall-cmg --zone=block --list-all      #verify firewall rule

sudo firewall-cmd --permanent --add-service nfs
sudo firewall-cmd --reload

with a firewall added to the system will filter out what network packets are allowed to come into our system and even what network packets are 
allowed to go out

red hat has firewalld
the firewall manager puts every network interface in zones, each zones has own rules
zone drop is very restrictive and blocks all incoming connections
zone trusted - all connections are accepted, for example in a office you ccepted all those incoming connections

the default zone is public, every incoming connection is blocked, except  what we allow
check the zone 
firewall-cmd --get-default-zone

change the zone
firewall-cmd --set-default-zone=public

to see current firewall rules
sudo firewall-cmd --list-all
 the output it will show the cockpit, where you can use a command to check the port are listening for the service cockpit
sudo firewall-cmd --info-service=cockpit 
 the output it will show the cockpit servie allow incoming connections to port example 9595 through a tcp protocol
 
to allow traffic can be both
sudo firewall-cmd --add-service=http   OR    sudo firewall-cmd --add-port=80/tcp

then if you check the list, it will add a new rule in front of the cockpit
sudo firewall-cmd --list-all

to remove
sudo firewall-cmd --remove-service=http    OR    sudo firewall-cmd --remove-port=80/tcp

instead to block all incoming traffic, can use different rule based on where the traffic is coming from
sudo firewall-cmd --add-source=10.11.12.0/24 --zone=trusted

block
sudo firewall-cmd --add-source=10.11.12.0/24 --zone=block --permanent 
sudo firewall-cmd --reload
sudo firewall-cmd --zone=block --list-all    #verify

check active zones
firewall-cmd --get-active-zones

Allow all traffic that is coming from any IP in this network range: 10.11.12.0 to 10.11.12.255 (i.e 10.11.12.0/24), 
add the required rule in the trusted zone and the rule must be permanent.
#
sudo firewall-cmd --add-source=10.11.12.0/24 --zone=trusted --permanent

remove filter based on ip addr
sudo firewall-cmd --remove-source=10.11.12.0/24 --zone=trusted

all the rules set above are no permanent if reboot the rules will be lost, to keep permanent does those commands below
sudo firewall-cmd --add-port=123/tcp                                                                              add
sudo firewall-cmd --list-all                                                                                      check
sudo firewall-cmd --runtime-to-permanent       OR       sudo firewall-cmd --add-port=123/tcp --permanent          permanent


SOFT and HARD limits===================================

nfsuser user is holding hundred of processes, which is degrading the performance of the server. Therefore, we have a requirement to limit its maximum processes. Please set its maximum process limits as below:
soft limit = 1024
hard_limit = 2027

vi /etc/security/limits.conf
nfsuser         soft    nproc           1024
nfsuser         hard    nproc           2027


SELinux ==================================================================


yum -y install selinux*

sestatus

# to keep persistent vi /etc/selinux/config or /etc/sysconfig/selinux 
SELINUX=Permissive   (edit this line)



MOTD =====================================

just add text in
/etc/motd



PACKAGE ==========================================

 find package
 mkfs.vfat

find package
dnf(yum) provides */mkfs.vfat

package manager - dnf, yum

list of which repo are currently enabled on the server/host
sudo yum repolist
sudo yum repolist -v    get a list of online repo, that your system is currently using 

sometimes the default repo dont include what we are looking for 
to list the optionals repo
sudo yum repolist --all
sudo subscription-manager repos --enable <repo.rpms>
sudo yum-config-manager --enable <repo.rpms>

if we dont find the repo we want and want add other repo
use the yum conf manager
first install this utilities
sudo yum install yum-utils    this contains yum manager
sudo yum-config-manager --add-repo <website.repo>       add the repo online
sudo yum-config-manager --add-repo <IP/Repo.repo>       add the repo local
    with that will create /etc/yum.repos.d/<repo>.repo


sudo vi  /etc/yum.repos.d/<repo>.repo
[base]    ->name of the repo
name=CentOS-$releasever - Base      -> long name for the repo
mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os&infra=$infra
baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/      ->tells where the repo is located, can be local or  in the internet
enabled = 1         -> 1 means available for use 
gpgcheck=1          -> check the validity of the package using gpg keys
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7     ->where is the gpg located


yum can also used to install and uninstall individual packages from repo
for that we need to know the name of the package, if you dont know can use yum to look for it
ex.: sudo yum search web server
sudo yum search 'web server'

sudo yum info <package>

sudo yum install <package>

sudo yum reinstall <package>
 
sudo yum remove <package>

to install packages in a certain group
sudo yum group list
sudo yum group list --hidden               display all of the possible package groups, including those that are hidden
sudo yum group install '<groupname>'

yum can install software from rpm packages
sudo wget https://package.rpm
sudo yum install <./package.rpm>
sudo yum remove <package_name>

sometimes packages pull in dependencies which are ohte components that they need to run correctly
when remove the package  some of those dependencies might be left behind
to make sure that remove automatically all dependencies after removed the package
sudo yum autoremove

update and upgrade packages
sudo yum check-upgrade  check which package needs an update
sudo yum update     to update all packages to the latest version

 WORKING WITH PACKAGES MODULES STREAM    ---------------------------------------------------------------------

stream allow to designate multiple versions of software packages to group together as modules
give greater flexibility and compatibility options
module is a set of packages that normally get installed together

available modules
sudo yum module list
sudo yum module list <service>

install
sudo yum module  install nodejs
sudo yum module list --installed nodejs


different version  (/name-of-profile), can get the name in module list
sudo yum install module nodejs:14/development

to change the module 
sudo yum module reset nodejs
sudo yum module  install nodejs:16/development
sudo yum module install php:8.0/minimal -y                                install the version 8.0 of the php module using the minimal profile

Reset the module stream for the container-tools package as below:
sudo yum -y module reset container-tools
Then use yum to install version 3.0 of the container-tools package with below command:

sudo yum -y module install container-tools:3.0 --skip-broken --allowerasing --nobest


ANSIBLE INSTALLATION ===========================================================

Install ansible version 4.9.0 on Jump host using pip3 only. Make sure Ansible binary is available globally on this system, i.e all users on this system are able to run Ansible commands.

pip uninstall ansible ansible-base
        
pip3 install ansible==4.9.0 --user     
sudo pip3 install ansible==4.9.0     make global the installation of ansible, all users on machine can run ansible


#confirm the version. The version displayed is for the associated ansible-core package.
ansible version 

understand BASE and CORE differences--------------------------
ansible 3.X.X
ansible base is 2.10.5+

ansible 4.X.X
ansible core is 2.11
When you install an ansible package 4.X.X comes with ansible core, before on ansible 3.X.X the "ansible core" was called ansible base, they just renamed

-----------------------------------------


CHECK LISTEN PORTS ======================================

cat /etc/httpd/conf/httpd.conf | grep Listen

cat /etc/nginx/nginx.conf | grep listen



INSTALL POSFIX and DOVECOT- EMAIL SERVER ========================================

Postfix is an open-source mail transfer agent (MTA), a service used to send and receive emails. 
Dovecot is an IMAP/POP3 server and handle local delivery and user authentication.

CHECK IF THERE IS ANOTHER EMAIL SERVER ON THE SERVER
rpm -qa | grep sendmail

in case there is just remmove
dnf remove sendmail

dnf update
sudo dnf install -y postfix
rpm -qa|grep postfix
systemctl enable postfix

configure an email -------------------------------

vi /etc/postfix/main.cf
myhostname = stmail01.stratos.xfusioncorp.com  
mydomain = stratos.xfusioncorp.com 
myorigin = $mydomain
inet_interfaces = all
  comment in 
    #inet_interfaces = localhost

mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
mynetworks = 172.16.238.0/24, 127.0.0.0/8
home_mailbox = Maildir/

test config -----------------------------------------

user add john -p dCV3szSGNA
dnf install -y telnet
telnet stmail01 25
EHLO localhost
mail from:john@stratos.xfusioncorp.com
rcpt to:john@stratos.xfusioncorp.com
DATA
354 End data with <CR><LF>.<CR><LF>
test mail
.
quit


login as john user
[john@stmail01 new]$ pwd
/home/john/Maildir/new
[john@stmail01 new]$ cat 1691920400.V801I4b15709M152300.stmail01.stratos.xfusioncorp.com 
Return-Path: <john@stratos.xfusioncorp.com>
X-Original-To: john@stratos.xfusioncorp.com
Delivered-To: john@stratos.xfusioncorp.com
Received: from localhost (stmail01 [172.16.238.17])
        by stmail01.stratos.xfusioncorp.com (Postfix) with ESMTP id 3135E47E3090
        for <john@stratos.xfusioncorp.com>; Sun, 13 Aug 2023 09:52:53 +0000 (UTC)
Message-Id: <20230813095306.3135E47E3090@stmail01.stratos.xfusioncorp.com>
Date: Sun, 13 Aug 2023 09:52:53 +0000 (UTC)
From: john@stratos.xfusioncorp.com

test mail

configure dovecot -------------------------
vi /etc/dovecot/dovecot.conf
protocols = imap pop3 lmtp 
listen = *, ::
vi /etc/dovecot/conf.d/10-mail.conf 
 mail_location = maildir:~/Maildir
vi /etc/dovecot/conf.d/10-auth.conf 
disable_plaintext_auth = yes
auth_mechanisms = plain login
vi /etc/dovecot/conf.d/10-master.conf
unix_listener auth-userdb {
    #mode = 0666
    user = postfix
    group = postfix


test the dovecot

telnet stmail01 110
Trying 172.16.238.17...
Connected to stmail01.
Escape character is '^]'.
+OK Dovecot ready.
john
-ERR Unknown command.
user john
+OK
pass dCV3szSGNA
+OK Logged in.
retr 1
+OK 508 octets
Return-Path: <john@stratos.xfusioncorp.com>
X-Original-To: john@stratos.xfusioncorp.com
Delivered-To: john@stratos.xfusioncorp.com
Received: from localhost (stmail01 [172.16.238.17])
        by stmail01.stratos.xfusioncorp.com (Postfix) with ESMTP id 3135E47E3090
        for <john@stratos.xfusioncorp.com>; Sun, 13 Aug 2023 09:52:53 +0000 (UTC)
Message-Id: <20230813095306.3135E47E3090@stmail01.stratos.xfusioncorp.com>
Date: Sun, 13 Aug 2023 09:52:53 +0000 (UTC)
From: john@stratos.xfusioncorp.com

test mail
.


Install and Configure HaProxy LBR =============================================================================
apache is running on port 3002 on all app servers. HAproxy must serve on default http port
--run the command netstat -anp | grep httpd to check the port opened in the app servers

vi /etc/haproxy/haproxy.cfg
yum install haproxy -y

cat /etc/haproxy/haproxy.cfg |grep app
    default_backend             app

frontend main
    bind *:80

backend app   
    balance     roundrobin
    server  app1 127.0.0.1:5001 check
    server  app2 127.0.0.1:5002 check
    server  app3 127.0.0.1:5003 check
    server  app4 127.0.0.1:5004 check
    server app1 172.16.238.10:3002 check
    server app1 172.16.238.11:3002 check
    server app1 172.16.238.12:3002 check

systemctl enable haproxy --now



MariaDB Troubleshooting ==============================================


